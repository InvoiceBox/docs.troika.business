---
layout: nocompress
nav_order: 2
title: "Схема взаимодействия"
---

# Схема взаимодействия агента с сервисом

<div class="mermaid">
sequenceDiagram
    autonumber
    participant Пользователь
    participant Агент
    participant Тройка.Бизнес
    participant Инвойсбокс
    rect rgb(204, 245, 204)
      Пользователь->>Агент: Создает запрос на пополнение БСК
      Агент->>Тройка.Бизнес: Вызов метода создания заказа
      Тройка.Бизнес->>Инвойсбокс: Подтверждение оплаты заказа
      Инвойсбокс->>Тройка.Бизнес: Подтверждение оплаты заказа
      Тройка.Бизнес->>Агент: Подтверждение заказа
      Агент->>Пользователь: Уведомление о необходимости записи билета на БСК
      Пользователь->>Тройка.Бизнес: Запись билета на БСК
      Тройка.Бизнес->>Инвойсбокс: Подтверждение записи билета
      Агент->>Инвойсбокс: Расчёт по записанным билетам
    end
</div>

1. Пользователь формирует запрос на пополнение БСК в системе Агента.
1. Агент создает в системе &laquo;Тройка.Бизнес&raquo; заказ [через метод API](/docs/order/create/).
1. Система &laquo;Тройка.Бизнес&raquo; уточняет возможность подтверждения заказа в расчётном центре &laquo;Инвойсбокс&raquo;.
1. Расчётный центр &laquo;Инвойсбокс&raquo; подтверждает заказа системе &laquo;Тройка.Бизнес&raquo;.
1. Система &laquo;Тройка.Бизнес&raquo; возвращает ответ системе Агента.
1. Агент уведомляет пользователя о возможности записать билет на БСК.
1. Пользователь записывает билет на БСК через систему &laquo;Тройка.Бизнес&raquo;.
1. Система &laquo;Тройка.Бизнес&raquo; перадёт информацию о записанном билете в расчётный центр &laquo;Инвойсбокс&raquo;.
1. Агент производит взаиморасчёты в расчётном центре &laquo;Инвойсбокс&raquo;.

---

[Читать далее &raquo;](/docs/methods){: .btn .btn-primary .fs-5 .mb-4 .mb-md-0 .mr-2 }
